<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Lottery Platinum - Auto System</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f0f0f; color: white; text-align: center; padding: 10px; margin: 0; }
        .box { background: #1e1e1e; padding: 20px; border-radius: 20px; max-width: 420px; margin: auto; border: 1px solid #d4af37; box-shadow: 0 10px 30px rgba(0,0,0,0.7); }
        .header-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: #2a2a2a; padding: 10px; border-radius: 12px; }
        input { width: 85%; padding: 12px; margin: 5px 0; border-radius: 10px; border: 1px solid #444; background: #111; color: gold; text-align: center; font-weight: bold; }
        button { width: 90%; padding: 12px; margin: 8px 0; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.3s; }
        .btn-gold { background: linear-gradient(135deg, #d4af37 0%, #f9d976 100%); color: #000; }
        .btn-red { background: #e74c3c; color: white; }
        .btn-blue { background: #3498db; color: white; }
        .angka-display { font-size: 3rem; font-weight: bold; color: gold; margin: 15px 0; text-shadow: 0 0 15px rgba(212, 175, 55, 0.5); font-family: 'Courier New', Courier, monospace; }
        .timer-box { font-size: 0.9rem; color: #f1c40f; margin-bottom: 10px; background: rgba(241, 196, 15, 0.1); padding: 5px; border-radius: 5px; }
        .nav-tabs { display: flex; background: #222; border-radius: 12px; margin-bottom: 15px; overflow: hidden; }
        .tab { flex: 1; padding: 10px; cursor: pointer; font-size: 0.75rem; transition: 0.3s; }
        .tab.active { background: gold; color: black; font-weight: bold; }
        .list-container { text-align: left; background: #151515; padding: 15px; border-radius: 15px; font-size: 0.8rem; max-height: 250px; overflow-y: auto; border: 1px solid #333; }
        .list-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #222; }
        #adminPanel { background: #2d0a0a; border-color: #e74c3c; display: none; margin-top: 20px; }
        .status-badge { font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
    </style>
</head>
<body>

<div id="loginPage" class="box" style="margin-top: 50px;">
    <h1 style="color: gold; margin-bottom: 5px;">VIP LOTTERY</h1>
    <p style="font-size: 0.8rem; color: #888;">Premium Auto-System v3.0</p>
    <input type="text" id="idPemain" placeholder="ID PEMAIN">
    <input type="password" id="passPemain" placeholder="PASSWORD">
    <button class="btn-gold" onclick="prosesLogin()">MASUK SERVER</button>
    <button style="background: #333; color: #aaa; font-size: 0.7rem;" onclick="prosesDaftar()">REGISTER (ADMIN ONLY)</button>
</div>

<div id="gamePage" class="box" style="display: none;">
    <div class="timer-box" id="nextDraw">Countdown: --:--:--</div>
    
    <div class="header-info">
        <span id="displayID" style="color: gold;">ðŸ‘¤ --</span>
        <span id="displayKoin" style="color: #2ecc71;">ðŸ’° 0</span>
    </div>

    <div class="nav-tabs">
        <div class="tab active" id="tabG" onclick="showSection('GAME')">GAME</div>
        <div class="tab" id="tabL" onclick="showSection('LEAD')">RANKING</div>
        <div class="tab" id="tabW" onclick="showSection('WD')">WITHDRAW</div>
    </div>

    <div id="secGame">
        <div class="angka-display" id="layarAngka">-- - -- - --</div>
        
        <div style="background: #252525; padding: 10px; border-radius: 12px; margin-bottom: 10px; border-left: 4px solid gold;">
            <p style="font-size: 0.7rem; margin: 0 0 5px 0; text-align: left;">JAWABAN 1:</p>
            <div style="display: flex; gap: 5px;">
                <input type="number" id="tebak1" placeholder="Angka 1-80" style="width: 45%;">
                <input type="number" id="bet1" placeholder="Koin" style="width: 45%;">
            </div>
        </div>

        <div style="background: #252525; padding: 10px; border-radius: 12px; margin-bottom: 10px; border-left: 4px solid #3498db;">
            <p style="font-size: 0.7rem; margin: 0 0 5px 0; text-align: left;">JAWABAN 2:</p>
            <div style="display: flex; gap: 5px;">
                <input type="number" id="tebak2" placeholder="Angka 1-80" style="width: 45%;">
                <input type="number" id="bet2" placeholder="Koin" style="width: 45%;">
            </div>
        </div>

        <button class="btn-gold" id="btnKunci" onclick="kunciGanda()">KUNCI SEMUA JAWABAN</button>

        <div class="list-container">
            <h4 style="margin: 0 0 10px 0; color: gold; text-align: center; font-size: 0.75rem;">LIVE BETS</h4>
            <div id="listTebakan"></div>
        </div>
    </div>

    <div id="secLead" style="display: none;">
        <h4 style="color: gold;">TOP SALDO</h4>
        <div class="list-container" id="leadSaldo" style="margin-bottom: 15px;"></div>
        <h4 style="color: #3498db;">TOP WINNERS</h4>
        <div class="list-container" id="leadWin"></div>
    </div>

    <div id="secWD" style="display: none;">
        <h3 style="color: #2ecc71;">WITHDRAWAL</h3>
        <p style="font-size: 0.7rem; color: #888;">Min: 1 | Max: 2000 per WD</p>
        <input type="number" id="wdAmount" placeholder="Nominal Koin">
        <button class="btn-blue" onclick="prosesWithdraw()">AJUKAN PENARIKAN</button>
        <div class="list-container">
            <h4 style="margin: 0 0 10px 0; font-size: 0.75rem;">RIWAYAT WD SAYA</h4>
            <div id="myWDList"></div>
        </div>
    </div>

    <div style="margin-top: 15px; opacity: 0.3; font-size: 0.6rem; cursor: pointer;" onclick="bukaAdmin()">ADMIN PANEL</div>
</div>

<div id="adminPanel" class="box">
    <h3>ADMIN CONTROL</h3>
    <input type="text" id="admID" placeholder="ID Tujuan">
    <input type="number" id="admQty" placeholder="Jumlah Koin">
    <button class="btn-blue" onclick="admKoin()">TAMBAH KOIN</button>
    <hr style="border-color: #444;">
    <p style="font-size: 0.7rem;">MANUAL DRAW (1-80):</p>
    <div style="display: flex; gap: 5px;">
        <input type="number" id="res1" style="width: 30%">
        <input type="number" id="res2" style="width: 30%">
        <input type="number" id="res3" style="width: 30%">
    </div>
    <button class="btn-red" onclick="admPutar()">PUTAR SEKARANG</button>
    <button class="btn-gold" onclick="resetRondeManual()">RESET RONDE</button>
    
    <h4 style="color: #e74c3c; margin-top: 20px; font-size: 0.8rem;">PERMINTAAN WD MASUK</h4>
    <div class="list-container" id="admWDList" style="background: #000;"></div>
</div>

<script>
// --- CONFIG FIREBASE ---
const firebaseConfig = {
    apiKey: "AIzaSyAkeywT1lnLHPLJUnfWGNtsSqiePttpzPo",
    authDomain: "avatar-lotere.firebaseapp.com",
    projectId: "avatar-lotere",
    databaseURL: "https://avatar-lotere-default-rtdb.firebaseio.com" 
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const PIN_ADMIN = "#har142000";

let userUID = null;
let userKoin = 0;
let userTotalWin = 0;
let isSpinning = false;

// --- AUTH ---
function prosesDaftar() {
    if(prompt("PIN ADMIN:") !== PIN_ADMIN) return;
    let id = document.getElementById('idPemain').value.trim();
    let ps = document.getElementById('passPemain').value.trim();
    if(id && ps) {
        db.ref('users/' + id).set({ password: ps, coins: 0, totalWin: 0 });
        alert("Terdaftar!");
    }
}

function prosesLogin() {
    let id = document.getElementById('idPemain').value.trim();
    let ps = document.getElementById('passPemain').value.trim();
    db.ref('users/' + id).once('value', s => {
        let d = s.val();
        if(d && d.password === ps) {
            userUID = id;
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('gamePage').style.display = 'block';
            document.getElementById('displayID').innerText = "ðŸ‘¤ " + id.toUpperCase();
            initRealtime();
        } else alert("Akses Ditolak!");
    });
}

function showSection(s) {
    document.getElementById('secGame').style.display = s==='GAME'?'block':'none';
    document.getElementById('secLead').style.display = s==='LEAD'?'block':'none';
    document.getElementById('secWD').style.display = s==='WD'?'block':'none';
    document.getElementById('tabG').className = s==='GAME'?'tab active':'tab';
    document.getElementById('tabL').className = s==='LEAD'?'tab active':'tab';
    document.getElementById('tabW').className = s==='WD'?'tab active':'tab';
}

function initRealtime() {
    // Pantau Data User Sendiri
    db.ref('users/' + userUID).on('value', s => {
        let d = s.val();
        if(!d) return;
        userKoin = d.coins || 0;
        userTotalWin = d.totalWin || 0;
        document.getElementById('displayKoin').innerText = "ðŸ’° " + userKoin;
    });

    // Pantau Perintah Putar (Spin)
    db.ref('roomControl').on('value', s => {
        let d = s.val();
        if(d && d.action === 'SPIN' && !isSpinning) runAnimation(d.results);
    });

    // PANTAU TARUHAN GLOBAL (LIVE BETS) - MENAMPILKAN KOIN TIAP TEBAKAN
    db.ref('guesses').on('value', s => {
        let data = s.val();
        let h = "";
        if(data) {
            Object.keys(data).forEach(u => {
                let g = data[u];
                let detail = `ðŸŽ¯ [${g.g1}] Bet: ðŸ’°${g.b1}`;
                if(g.g2 && g.g2 !== 0) {
                    detail += `<br>ðŸŽ¯ [${g.g2}] Bet: ðŸ’°${g.b2}`;
                }

                h += `<div class="list-item" style="border-bottom:1px solid #333; padding:8px 0;">
                        <div style="text-align:left;">
                            <span style="color:gold; font-weight:bold; font-size:0.8rem;">ðŸ‘¤ ${u.toUpperCase()}</span>
                            <div style="font-size:0.7rem; color:#ccc; margin-top:2px;">${detail}</div>
                        </div>
                        <div style="align-self:center;">
                            <span style="font-size:0.55rem; background:#333; padding:2px 4px; border-radius:3px;">LOCKED</span>
                        </div>
                      </div>`;
            });
        }
        document.getElementById('listTebakan').innerHTML = h || "Menunggu tebakan...";
    });

    // Leaderboard Saldo
    db.ref('users').orderByChild('coins').limitToLast(10).on('value', s => {
        let arr = []; s.forEach(x => { arr.push({id: x.key, val: x.val().coins}) });
        renderLeader(arr.reverse(), 'leadSaldo');
    });

    // Leaderboard Kemenangan
    db.ref('users').orderByChild('totalWin').limitToLast(10).on('value', s => {
        let arr = []; s.forEach(x => { arr.push({id: x.key, val: x.val().totalWin}) });
        renderLeader(arr.reverse(), 'leadWin');
    });

    // Pantau WD
    db.ref('withdraws').on('value', s => {
        let d = s.val();
        let hUser = ""; let hAdm = "";
        if(d) {
            Object.keys(d).forEach(k => {
                let w = d[k];
                let color = w.status === "PENDING" ? "#f1c40f" : "#2ecc71";
                if(w.user === userUID) {
                    hUser += `<div class="list-item"><span>ðŸ’° ${w.amount}</span><span style="color:${color}">${w.status}</span></div>`;
                }
                if(w.status === "PENDING") {
                    hAdm += `<div class="list-item" style="flex-direction:column; align-items:flex-start; padding:10px 0;">
                        <span><b>${w.user}</b>: ${w.amount} Koin</span>
                        <div style="display:flex; gap:5px; margin-top:5px; width:100%">
                            <button onclick="accWD('${k}')" style="background:#2ecc71; padding:5px; margin:0; font-size:0.6rem">SETUJUI</button>
                            <button onclick="rejectWD('${k}', '${w.user}', ${w.amount})" style="background:#e74c3c; padding:5px; margin:0; font-size:0.6rem">TOLAK</button>
                        </div>
                    </div>`;
                }
            });
        }
        document.getElementById('myWDList').innerHTML = hUser || "Belum ada riwayat.";
        document.getElementById('admWDList').innerHTML = hAdm || "Antrean kosong.";
    });

    setInterval(updateTimer, 1000);
}

function renderLeader(data, target) {
    let h = "";
    data.forEach((p, i) => {
        h += `<div class="list-item"><span>${i+1}. ${p.id.toUpperCase()}</span><b>${p.val}</b></div>`;
    });
    document.getElementById(target).innerHTML = h;
}

// --- GAMEPLAY ---
function kunciGanda() {
    let g1 = parseInt(document.getElementById('tebak1').value);
    let b1 = parseInt(document.getElementById('bet1').value);
    let g2 = parseInt(document.getElementById('tebak2').value);
    let b2 = parseInt(document.getElementById('bet2').value);

    if(!g1 || !b1 || g1 > 80 || g1 < 1) return alert("Angka 1 harus 1-80!");
    let totalBet = b1 + (b2 || 0);
    if(userKoin < totalBet) return alert("Koin tidak cukup!");

    db.ref('users/' + userUID).update({ coins: userKoin - totalBet });
    db.ref('guesses/' + userUID).set({ g1: g1, b1: b1, g2: g2 || 0, b2: b2 || 0 });
    
    document.getElementById('btnKunci').disabled = true;
    document.getElementById('btnKunci').innerText = "NUMBERS LOCKED";
}

function runAnimation(res) {
    isSpinning = true;
    let lay = document.getElementById('layarAngka');
    let c = 0;
    let inv = setInterval(() => {
        lay.innerText = `${rand80()} - ${rand80()} - ${rand80()}`;
        if(++c > 40) {
            clearInterval(inv);
            lay.innerText = `${res[0]} - ${res[1]} - ${res[2]}`;
            checkWinner(res);
            setTimeout(() => { isSpinning = false; }, 5000);
        }
    }, 50);
}

function rand80() { return Math.floor(Math.random() * 80) + 1; }

function checkWinner(res) {
    db.ref('guesses/' + userUID).once('value', s => {
        let d = s.val();
        if(!d) return;
        let winPrize = 0;
        if(res.includes(parseInt(d.g1))) winPrize += d.b1 * 5;
        if(res.includes(parseInt(d.g2)) && d.g2 !== 0) winPrize += d.b2 * 5;
        
        if(winPrize > 0) {
            alert("JACKPOT! Anda menang ðŸ’°" + winPrize);
            db.ref('users/' + userUID).update({ 
                coins: userKoin + winPrize,
                totalWin: userTotalWin + winPrize
            });
        }
    });
}

// --- AUTO SYSTEM ---
function updateTimer() {
    const now = new Date();
    const schedules = ["09:00", "21:00"];
    let next = null;
    for (let t of schedules) {
        let [h, m] = t.split(':');
        let target = new Date(); target.setHours(h, m, 0);
        if (target > now) { next = target; break; }
    }
    if (!next) { next = new Date(); next.setDate(next.getDate() + 1); next.setHours(9, 0, 0); }
    
    let diff = next - now;
    let hrs = Math.floor(diff/3600000).toString().padStart(2,'0');
    let mins = Math.floor((diff%3600000)/60000).toString().padStart(2,'0');
    let secs = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
    document.getElementById('nextDraw').innerText = `NEXT DRAW: ${hrs}:${mins}:${secs}`;
    
    if(diff <= 1000 && !isSpinning) triggerAutoSpin();
}

function triggerAutoSpin() {
    db.ref('roomControl/action').once('value', s => {
        if(s.val() !== 'SPIN') {
            db.ref('roomControl').set({ action: 'SPIN', results: [rand80(), rand80(), rand80()] });
            setTimeout(resetRondeManual, 10000);
        }
    });
}

// --- WD & ADMIN ---
function prosesWithdraw() {
    let a = parseInt(document.getElementById('wdAmount').value);
    if(a > 0 && a <= 2000 && userKoin >= a) {
        db.ref('users/'+userUID).update({ coins: userKoin - a });
        db.ref('withdraws').push({ user: userUID, amount: a, status: "PENDING" });
        document.getElementById('wdAmount').value = "";
        alert("WD Berhasil diajukan!");
    } else alert("Nominal tidak valid!");
}

function accWD(key) {
    if(confirm("Setujui penarikan ini?")) db.ref('withdraws/' + key).update({ status: "SUKSES" });
}

function rejectWD(key, uid, amount) {
    if(confirm("Tolak penarikan dan kembalikan koin?")) {
        db.ref('users/' + uid + '/coins').once('value', s => {
            db.ref('users/' + uid).update({ coins: (s.val() || 0) + amount });
            db.ref('withdraws/' + key).remove();
        });
    }
}

function bukaAdmin() { if(prompt("PIN:") === PIN_ADMIN) document.getElementById('adminPanel').style.display = 'block'; }
function admKoin() {
    let id = document.getElementById('admID').value.toLowerCase();
    let qty = parseInt(document.getElementById('admQty').value);
    db.ref('users/'+id+'/coins').once('value', s => {
        db.ref('users/'+id).update({ coins: (s.val()||0) + qty });
        alert("Koin ditambahkan!");
    });
}
function admPutar() {
    let r = [parseInt(document.getElementById('res1').value), parseInt(document.getElementById('res2').value), parseInt(document.getElementById('res3').value)];
    if(r.some(isNaN)) return alert("Isi 3 angka hasil!");
    db.ref('roomControl').set({ action: 'SPIN', results: r });
}
function resetRondeManual() {
    db.ref('guesses').remove();
    db.ref('roomControl').remove();
    document.getElementById('btnKunci').disabled = false;
    document.getElementById('btnKunci').innerText = "KUNCI SEMUA JAWABAN";
}
</script>
</body>
</html>
